#!/bin/bash
# Change tmux status bar color theme per-session
# Usage:
#   tmux-theme <color>          - set theme on current session
#   tmux-theme -g <color>       - set theme globally (all sessions)
#   tmux-theme --list           - list available themes
#   tmux-theme --cycle          - cycle to next theme (current session)

declare -A THEMES=(
  [green]="bg=#a6e3a1,fg=#1e1e2e"
  [yellow]="bg=#f9e2af,fg=#1e1e2e"
  [blue]="bg=#89b4fa,fg=#1e1e2e"
  [red]="bg=#f38ba8,fg=#1e1e2e"
  [purple]="bg=#cba6f7,fg=#1e1e2e"
  [orange]="bg=#fab387,fg=#1e1e2e"
  [pink]="bg=#f5c2e7,fg=#1e1e2e"
  [teal]="bg=#94e2d5,fg=#1e1e2e"
  [sky]="bg=#89dceb,fg=#1e1e2e"
  [white]="bg=#cdd6f4,fg=#1e1e2e"
  [dark]="bg=#313244,fg=#cdd6f4"
)

THEME_ORDER=(green yellow blue red purple orange pink teal sky white dark)

GLOBAL=0

list_themes() {
  echo "Available themes:"
  for name in "${THEME_ORDER[@]}"; do
    echo "  $name"
  done
}

apply_theme() {
  local name="$1"
  local theme="${THEMES[$name]}"
  if [[ -z "$theme" ]]; then
    echo "Unknown theme: $name"
    list_themes
    return 1
  fi

  local bg="${theme%%,*}"
  bg="${bg#bg=}"
  local fg="${theme##*,}"
  fg="${fg#fg=}"

  local flag=""
  if [[ $GLOBAL -eq 1 ]]; then
    flag="-g"
  fi

  tmux set $flag status-style "bg=$bg,fg=$fg"
  tmux set $flag status-left-style "bg=$bg,fg=$fg,bold"
  tmux set $flag status-right-style "bg=$bg,fg=$fg"
  tmux set $flag window-status-current-style "bg=$fg,fg=$bg,bold"
  tmux set $flag window-status-style "bg=$bg,fg=$fg"
  tmux set $flag message-style "bg=$fg,fg=$bg"
  tmux set $flag @current-theme "$name"
}

cycle_theme() {
  local current
  current=$(tmux show -v @current-theme 2>/dev/null || tmux show -gv @current-theme 2>/dev/null || echo "green")
  local next=""
  local found=0
  for name in "${THEME_ORDER[@]}"; do
    if [[ $found -eq 1 ]]; then
      next="$name"
      break
    fi
    if [[ "$name" == "$current" ]]; then
      found=1
    fi
  done
  # Wrap around
  if [[ -z "$next" ]]; then
    next="${THEME_ORDER[0]}"
  fi
  apply_theme "$next"
  tmux display-message "Theme: $next"
}

# Parse flags
while [[ $# -gt 0 ]]; do
  case "$1" in
    -g|--global)
      GLOBAL=1
      shift
      ;;
    --list|-l)
      list_themes
      exit 0
      ;;
    --cycle|-c)
      cycle_theme
      exit 0
      ;;
    -*)
      echo "Unknown flag: $1"
      echo "Usage: tmux-theme [-g] <color|--list|--cycle>"
      exit 1
      ;;
    *)
      apply_theme "$1"
      exit 0
      ;;
  esac
done

echo "Usage: tmux-theme [-g] <color|--list|--cycle>"
echo "  -g    Apply globally to all sessions (default: current session only)"
